tests:
  diff_test:
    setup:
      - "ruby ./bin/generate_sort_hashjoin_dataset.rb 10000 10000"
      - "ruby ./bin/benchmark.rb --prepare-mysql"
    tests:
      - name: "Basic test"
        sql: "./homemade-dataset/homemade.sql"
        expected: "./homemade-dataset/homemade.expected"

      - name: "Disable optimistic hash join"
        sql: "./homemade-dataset/homemade-disabled.sql"
        expected: "./homemade-dataset/homemade-disabled.expected"

      - name: "No interesting order => no optimistic hash join"
        sql: "./homemade-dataset/no-order.sql"
        expected: "./homemade-dataset/no-order.expected"

      - name: "Set optimism level hint"
        sql: "./homemade-dataset/homemade-optimism-value.sql"
        expected: "./homemade-dataset/homemade-optimism-value.expected"

  contain_test:
    # here there is no global setup. Allowed.
    tests:
      - name: "went_on_disk=false, n=100 m=100"
        setup:
          - "ruby ./bin/generate_sort_hashjoin_dataset.rb 100 100"
          - "ruby ./bin/benchmark.rb --prepare-mysql"
        sql: "./homemade-dataset/went-on-disk.sql"
        contains:
          - "optimistic hash join"
          - "(went_on_disk=false)"

      - name: "went_on_disk=true, n=10000 m=10000"
        setup:
          - "ruby ./bin/generate_sort_hashjoin_dataset.rb 10000 10000"
          - "ruby ./bin/benchmark.rb --prepare-mysql"

        sql: "./homemade-dataset/went-on-disk.sql"
        contains:
          - "optimistic hash join"
          - "(went_on_disk=true)"

      - name: "Set optimism func hint"
        sql: "./homemade-dataset/homemade-optimism-func.sql"
        contains:
          - "SIGMOID"
